<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Lost & Found</title>
		<link rel="website icon" type="png" href="./Logo2.png" />
		<style>
			/* General Reset */
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
				font-family: "Segoe UI", sans-serif;
			}

			html,
			body {
				height: 100%;
				overflow-x: hidden;
				color: #f5f5f5;
			}

			/* Background Gradient */
			body {
				background: linear-gradient(135deg, #0d0d2b, #1c1c3c);
				display: flex;
				justify-content: center;
				align-items: center;
				position: relative;
			}

			/* Particles */
			#tsparticles {
				position: fixed;
				width: 100%;
				height: 100%;
				top: 0;
				left: 0;
				z-index: -1;
			}

			/* Form Container */
			.form-container {
				background: rgba(255, 255, 255, 0.08);
				backdrop-filter: blur(12px);
				border-radius: 15px;
				width: 100%;
				max-width: 450px;
				padding: 2rem;
				box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
				position: relative;
				z-index: 1;
				text-align: center;
			}

			/* Toggle Buttons */
			.form-toggle {
				display: flex;
				margin-bottom: 1.5rem;
			}

			.toggle-btn {
				flex: 1;
				padding: 0.5rem;
				text-align: center;
				background: rgba(255, 255, 255, 0.1);
				color: #f5f5f5;
				cursor: pointer;
				transition: all 0.3s ease;
				border: none;
				border-radius: 8px;
				margin: 0 2px;
				font-weight: bold;
			}

			.toggle-btn.active.login {
				background: #ffa726;
				color: #0d0d2b;
			}

			.toggle-btn.active.register {
				background: #009688;
				color: #fff;
			}

			/* Forms */
			form {
				text-align: left;
				background: rgba(255, 255, 255, 0.08);
				padding: 2rem;
				border-radius: 15px;
				backdrop-filter: blur(12px);
			}

			form label {
				display: block;
				margin: 12px 0 6px;
				font-weight: bold;
			}

			form input {
				width: 100%;
				padding: 12px;
				border: none;
				border-radius: 8px;
				margin-bottom: 1rem;
				outline: none;
				background: rgba(255, 255, 255, 0.15);
				color: #f5f5f5;
			}

			form input::placeholder {
				color: rgba(245, 245, 245, 0.7);
			}

			/* Buttons */
			.login-form button {
				width: 100%;
				padding: 14px;
				border: none;
				border-radius: 30px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				color: #0d0d2b;
				background: #ffa726;
				font-size: 1rem;
			}

			.login-form button:hover {
				background: #fb8c00;
				transform: scale(1.03);
			}

			.register-form button {
				width: 100%;
				padding: 14px;
				border: none;
				border-radius: 30px;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				color: #fff;
				background: #009688;
				font-size: 1rem;
			}

			.register-form button:hover {
				background: #00796b;
				transform: scale(1.03);
			}

			/* Alerts */
			.alert {
				padding: 0.75rem;
				margin-bottom: 1rem;
				border-radius: 8px;
				text-align: center;
				display: none;
			}

			.alert-error {
				background-color: rgba(255, 0, 0, 0.15);
				color: #ff6b6b;
			}

			.alert-success {
				background-color: rgba(0, 255, 0, 0.15);
				color: #00e676;
			}

			/* Verification Info */
			.verification-info {
				background: rgba(255, 255, 255, 0.08);
				padding: 1rem;
				border-radius: 15px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				margin-bottom: 1rem;
			}

			.verification-title {
				font-weight: bold;
				margin-bottom: 0.5rem;
				color: #ffa726;
			}

			.verification-email {
				font-weight: bold;
				color: #009688;
			}

			.resend-btn {
				margin-top: 0.5rem;
				background: #009688;
				color: #fff;
				border: none;
				padding: 10px 18px;
				border-radius: 12px;
				cursor: pointer;
				transition: all 0.3s ease;
			}

			.resend-btn:hover {
				background: #00796b;
				transform: scale(1.05);
			}

			/* Links */
			.forgot-password-link,
			.back-to-login-link,
			.back-link {
				display: block;
				text-align: center;
				margin-top: 0.5rem;
				color: #ffa726;
				text-decoration: none;
				font-size: 0.9rem;
				transition: all 0.3s ease;
			}

			.forgot-password-link:hover,
			.back-to-login-link:hover,
			.back-link:hover {
				color: #ffb74d;
				text-decoration: underline;
			}

			/* Hide all forms initially */
			.login-form,
			.register-form,
			.forgot-password-form,
			.verification-info {
				display: none;
			}

			.login-form.active,
			.register-form.active,
			.forgot-password-form.active,
			.verification-info.active {
				display: block;
			}
		</style>
	</head>

	<body>
		<div id="tsparticles"></div>
		<a href="index.html">
			<div class="brand"><img src="./Logo1.png" alt=""></div>
		</a>
		<div class="form-container">
			<div class="form-toggle">
				<button class="toggle-btn active login" id="loginBtn">Login</button>
				<button class="toggle-btn register" id="registerBtn">Register</button>
			</div>
			<div class="alert alert-error" id="errorAlert"></div>
			<div class="alert alert-success" id="successAlert"></div>
			<div class="verification-info" id="verificationInfo">
				<div class="verification-title">Email Verification Required</div>
				<p>We've sent a verification link to:</p>
				<p class="verification-email" id="verificationEmail"></p>
				<p> Please check your inbox and click the link to verify your account. </p>
				<button class="resend-btn" id="resendBtn"> Resend Verification Email </button>
			</div>
			<form class="login-form active" id="loginForm">
				<label for="loginEmail">Email</label>
				<input type="email" id="loginEmail" required placeholder="Enter your email" />
				<label for="loginPassword">Password</label>
				<input  type="password" id="loginPassword" required placeholder="Enter your password" />
				<button type="submit">Login</button>
				<a href="#" class="forgot-password-link" id="forgotPasswordLink">Forgot Password?</a>
			</form>
			<form class="register-form" id="registerForm">
				<label for="registerUsername">Username</label>
				<input type="text" id="registerUsername" required placeholder="Choose a username" />
				<label for="registerEmail">Email</label>
				<input type="email" id="registerEmail" required placeholder="Enter your email" />
				<label for="registerPassword">Password</label>
				<input type="password" id="registerPassword" required placeholder="Choose a password" />
				<label for="registerConfirmPassword">Confirm Password</label>
				<input type="password" id="registerConfirmPassword" required placeholder="Confirm your password" />
				<button type="submit">Register</button>
			</form>
			<form class="forgot-password-form" id="forgotPasswordForm">
				<label for="resetEmail">Email</label>
				<input type="email" id="resetEmail" required placeholder="Enter your email" />
				<button type="submit">Reset Password</button>
				<a href="#" class="back-to-login-link" id="backToLoginLink">Back to Login</a>
			</form>
			<a href="index.html" class="back-link">Back to Home</a>
		</div>
		<!-- tsparticles CDN -->
		<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
		<script type="module">
			// Toggle forms
			import {
				registerUser,
				loginUser,
				sendPasswordResetEmail,
				resendVerificationEmail,
			} from "./firebase.js";
			const loginBtn = document.getElementById("loginBtn");
			const registerBtn = document.getElementById("registerBtn");
			const loginForm = document.getElementById("loginForm");
			const registerForm = document.getElementById("registerForm");
			const forgotPasswordForm = document.getElementById("forgotPasswordForm");
			const forgotPasswordLink = document.getElementById("forgotPasswordLink");
			const backToLoginLink = document.getElementById("backToLoginLink");
			const errorAlert = document.getElementById("errorAlert");
			const successAlert = document.getElementById("successAlert");
			const verificationInfo = document.getElementById("verificationInfo");
			const verificationEmail = document.getElementById("verificationEmail");
			const resendBtn = document.getElementById("resendBtn");

			let currentUser = null;

			loginBtn.addEventListener("click", () => {
				loginBtn.classList.add("active", "login");
				registerBtn.classList.remove("active");
				loginForm.classList.add("active");
				registerForm.classList.remove("active");
				forgotPasswordForm.classList.remove("active");
				verificationInfo.classList.remove("active");
				hideAlerts();
			});

			registerBtn.addEventListener("click", () => {
				registerBtn.classList.add("active", "register");
				loginBtn.classList.remove("active");
				registerForm.classList.add("active");
				loginForm.classList.remove("active");
				forgotPasswordForm.classList.remove("active");
				verificationInfo.classList.remove("active");
				hideAlerts();
			});

			forgotPasswordLink.addEventListener("click", (e) => {
				e.preventDefault();
				loginForm.classList.remove("active");
				forgotPasswordForm.classList.add("active");
				hideAlerts();
			});

			backToLoginLink.addEventListener("click", (e) => {
				e.preventDefault();
				forgotPasswordForm.classList.remove("active");
				loginForm.classList.add("active");
				hideAlerts();
			});

			// Login form submission
			loginForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				hideAlerts();

				const email = document.getElementById("loginEmail").value;
				const password = document.getElementById("loginPassword").value;

				if (!email || !password) {
					showError("Please fill in all fields");
					return;
				}

				try {
					const result = await loginUser(email, password);
					if (result.success) {
						showSuccess("Login successful! Redirecting...");
						// Redirect to home page after 1 second
						setTimeout(() => {
							window.location.href = "index.html";
						}, 1000);
					} else if (result.needsVerification) {
						// Show verification info and store user for resend functionality
						currentUser = result.user;
						verificationEmail.textContent = email;
						loginForm.classList.remove("active");
						verificationInfo.classList.add("active");
					} else {
						showError(result.error || "Login failed. Please try again.");
					}
				} catch (error) {
					showError("An error occurred. Please try again.");
					console.error(error);
				}
			});

			// Register form submission
			registerForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				hideAlerts();

				const username = document.getElementById("registerUsername").value;
				const email = document.getElementById("registerEmail").value;
				const password = document.getElementById("registerPassword").value;
				const confirmPassword = document.getElementById(
					"registerConfirmPassword"
				).value;

				if (!username || !email || !password || !confirmPassword) {
					showError("Please fill in all fields");
					return;
				}

				if (password !== confirmPassword) {
					showError("Passwords do not match");
					return;
				}

				if (password.length < 8) {
					showError("Password must be at least 8 characters");
					return;
				}

				try {
					const result = await registerUser(email, password, username);
					if (result.success) {
						// Store user for resend functionality
						currentUser = result.user;

						// Show verification info
						registerForm.classList.remove("active");
						verificationEmail.textContent = email;
						verificationInfo.classList.add("active");

						showSuccess("Registration successful! Please verify your email.");
					} else {
						showError(result.error || "Registration failed. Please try again.");
					}
				} catch (error) {
					showError("An error occurred. Please try again.");
					console.error(error);
				}
			});

			// Forgot password form submission
			forgotPasswordForm.addEventListener("submit", async (e) => {
				e.preventDefault();
				hideAlerts();

				const email = document.getElementById("resetEmail").value;

				if (!email) {
					showError("Please enter your email address");
					return;
				}

				try {
					const result = await sendPasswordResetEmail(email);
					if (result.success) {
						showSuccess("Password reset email sent! Please check your inbox.");
					} else {
						showError(
							result.error ||
							"Failed to send password reset email. Please try again."
						);
					}
				} catch (error) {
					showError("An error occurred. Please try again.");
					console.error(error);
				}
			});

			// Resend verification email
			resendBtn.addEventListener("click", async () => {
				if (!currentUser) {
					showError("No user found. Please try logging in again.");
					return;
				}

				try {
					const result = await resendVerificationEmail(currentUser);
					if (result.success) {
						showSuccess("Verification email resent successfully!");
					} else {
						showError(
							result.error || "Failed to resend email. Please try again."
						);
					}
				} catch (error) {
					showError("An error occurred. Please try again.");
					console.error(error);
				}
			});

			function showError(msg) {
				errorAlert.textContent = msg;
				errorAlert.style.display = "block";
			}

			function showSuccess(msg) {
				successAlert.textContent = msg;
				successAlert.style.display = "block";
			}

			function hideAlerts() {
				errorAlert.style.display = "none";
				successAlert.style.display = "none";
			}

			// Initialize tsparticles
			document.addEventListener("DOMContentLoaded", () => {
				tsParticles.load("tsparticles", {
					background: { color: "#0d0d2b" },
					fpsLimit: 60,
					particles: {
						number: { value: 80 },
						color: { value: ["#ffffff", "#FFA726", "#009688"] },
						links: {
							enable: true,
							distance: 140,
							color: "#fff",
							opacity: 0.25,
						},
						move: { enable: true, speed: 1 },
						size: { value: { min: 2, max: 4 } },
						opacity: { value: 0.6 },
					},
					interactivity: {
						events: { onHover: { enable: true, mode: "repulse" } },
					},
					detectRetina: true,
				});
			});
		</script>
	</body>

</html>