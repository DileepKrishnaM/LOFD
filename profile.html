<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>My Profile - Lost & Found</title>
		<link rel="stylesheet" href="style.css">
		<link rel="icon" type="image/x-icon" href="./Logo2.png" />
		<script src="profile.js" type='module'></script>
		<style>
			.profile-img {
				width: 40px;
				height: 40px;
				border-radius: 50%;
			}

			.profile-container {
				position: relative;
				cursor: pointer;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.username-display {
				font-weight: bold;
				font-size: 1rem;
			}

			.profile-dropdown {
				position: absolute;
				right: 0;
				top: 45px;
				width: 150px;
				background-color: white;
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
				border-radius: 8px;
				padding: 0.5rem 0;
				display: none;
				z-index: 1001;
				color: #e07a5f;
			}

			.dropdown-username {
				padding: 0.5rem 1rem;
				font-weight: bold;
				text-align: center;
				word-wrap: break-word;
				max-width: 100%;
				cursor: pointer;
				transition: background-color 0.2s;
			}

			.dropdown-username:hover {
				background-color: #f5f5f5;
			}

			.dropdown-divider {
				height: 1px;
				background-color: #e7e7e7;
				margin: 0.25rem 0;
			}

			.dropdown-item {
				padding: 0.5rem 1rem;
				cursor: pointer;
				text-align: center;
			}

			.dropdown-item:hover {
				background-color: #f5f5f5;
			}

			.profile-dropdown.show {
				display: block;
			}

			/* Profile Page Specific Styles */
			.profile-header {
				text-align: center;
				padding: 80px 20px 30px;
				max-width: 1200px;
				margin: 0 auto;
				background: rgba(255, 255, 255, 0.05);
				border-radius: 20px;
				margin-top: 20px;
				backdrop-filter: blur(10px);
				border: 1px solid rgba(255, 255, 255, 0.1);
			}

			.profile-avatar {
				width: 120px;
				height: 120px;
				border-radius: 50%;
				margin: 0 auto 20px;
				display: block;
				border: 4px solid #FFA726;
				box-shadow: 0 10px 30px rgba(255, 167, 38, 0.3);
			}

			.profile-name {
				font-size: 2.5em;
				color: #fff;
				margin-bottom: 10px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
				font-weight: bold;
			}

			.profile-email {
				font-size: 1.2em;
				color: #FFA726;
				margin-bottom: 20px;
			}

			.profile-stats {
				display: flex;
				justify-content: center;
				gap: 40px;
				margin-top: 30px;
			}

			.stat-item {
				text-align: center;
			}

			.stat-number {
				font-size: 2.5em;
				color: #FFA726;
				font-weight: bold;
				margin-bottom: 5px;
			}

			.stat-label {
				color: #ccc;
				font-size: 1em;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.posts-section {
				max-width: 1200px;
				margin: 40px auto;
				padding: 0 20px;
			}

			.section-title {
				text-align: center;
				color: #fff;
				font-size: 2.5em;
				margin-bottom: 20px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
			}

			.posts-filter {
				display: flex;
				justify-content: center;
				gap: 20px;
				margin-bottom: 40px;
				flex-wrap: wrap;
			}

			.filter-btn {
				background: rgba(255, 255, 255, 0.1);
				border: 2px solid #FFA726;
				color: #FFA726;
				padding: 12px 25px;
				border-radius: 25px;
				cursor: pointer;
				font-weight: bold;
				transition: all 0.3s ease;
				text-transform: uppercase;
				letter-spacing: 1px;
			}

			.filter-btn.active,
			.filter-btn:hover {
				background: #FFA726;
				color: white;
				transform: scale(1.05);
				box-shadow: 0 5px 15px rgba(255, 167, 38, 0.3);
			}

			.posts-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
				gap: 30px;
				margin-top: 30px;
			}

			.post-card {
				background: rgba(255, 255, 255, 0.1);
				backdrop-filter: blur(10px);
				border-radius: 20px;
				padding: 25px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				transition: all 0.3s ease;
				position: relative;
				overflow: hidden;
			}

			.post-card::before {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background: linear-gradient(135deg, rgba(255, 167, 38, 0.1) 0%, rgba(0, 150, 136, 0.1) 100%);
				opacity: 0;
				transition: opacity 0.3s ease;
				z-index: 1;
			}

			.post-card:hover::before {
				opacity: 1;
			}

			.post-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
				border-color: #FFA726;
			}

			.post-card * {
				position: relative;
				z-index: 2;
			}

			.post-image {
				width: 100%;
				height: 200px;
				border-radius: 15px;
				object-fit: cover;
				margin-bottom: 20px;
				background: rgba(255, 255, 255, 0.1);
			}

			.post-image.error {
				display: flex;
				align-items: center;
				justify-content: center;
				color: #ccc;
				font-style: italic;
			}

			.post-title {
				font-size: 1.4em;
				color: #fff;
				margin-bottom: 10px;
				font-weight: bold;
			}

			.post-details {
				display: flex;
				flex-direction: column;
				gap: 8px;
				margin-bottom: 20px;
			}

			.post-detail-item {
				display: flex;
				align-items: center;
				gap: 8px;
				color: #ccc;
				font-size: 0.9em;
			}

			.post-detail-icon {
				color: #FFA726;
				font-weight: bold;
			}

			.post-status {
				display: inline-block;
				padding: 6px 15px;
				border-radius: 20px;
				font-size: 0.8em;
				font-weight: bold;
				text-transform: uppercase;
				letter-spacing: 1px;
				margin-bottom: 15px;
			}

			.status-active {
				background: rgba(76, 175, 80, 0.2);
				color: #4CAF50;
				border: 1px solid #4CAF50;
			}

			.status-found {
				background: rgba(255, 167, 38, 0.2);
				color: #FFA726;
				border: 1px solid #FFA726;
			}

			.post-actions {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
			}

			.action-btn {
				flex: 1;
				min-width: 100px;
				padding: 10px 15px;
				border: none;
				border-radius: 20px;
				cursor: pointer;
				font-weight: bold;
				transition: all 0.3s ease;
				text-decoration: none;
				text-align: center;
				font-size: 0.9em;
			}

			.btn-primary {
				background: linear-gradient(45deg, #FFA726, #FF7043);
				color: white;
			}

			.btn-secondary {
				background: rgba(255, 255, 255, 0.1);
				color: #FFA726;
				border: 1px solid #FFA726;
			}

			.action-btn:hover {
				transform: scale(1.05);
				box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
			}

			.empty-state {
				text-align: center;
				padding: 60px 20px;
				color: #ccc;
			}

			.empty-icon {
				font-size: 4em;
				margin-bottom: 20px;
				opacity: 0.5;
			}

			.empty-message {
				font-size: 1.2em;
				margin-bottom: 30px;
			}

			.empty-action {
				background: linear-gradient(45deg, #FFA726, #FF7043);
				color: white;
				border: none;
				padding: 15px 30px;
				border-radius: 25px;
				cursor: pointer;
				font-weight: bold;
				font-size: 1em;
				text-decoration: none;
				display: inline-block;
				transition: all 0.3s ease;
			}

			.empty-action:hover {
				transform: scale(1.05);
				box-shadow: 0 10px 25px rgba(255, 167, 38, 0.3);
			}

			.loading-spinner {
				display: flex;
				justify-content: center;
				align-items: center;
				height: 200px;
				color: #FFA726;
				font-size: 1.2em;
			}

			@media (max-width: 768px) {
				.profile-stats {
					flex-direction: column;
					gap: 20px;
				}

				.posts-filter {
					flex-direction: column;
					align-items: center;
				}

				.posts-grid {
					grid-template-columns: 1fr;
					gap: 20px;
				}

				.profile-name {
					font-size: 2em;
				}

				.section-title {
					font-size: 2em;
				}

				.post-actions {
					flex-direction: column;
				}

				.action-btn {
					min-width: unset;
				}
			}
		</style>
	</head>

	<body>
		<div id="tsparticles"></div>
		<header class="navbar">
			<a href="index.html">
				<div class="brand"><img src="./Logo1.png" alt=""></div>
			</a>
			<div class="nav-right">
				<button class="btn btn-browse" onclick="location.href='index.html'">Home</button>
				<button class="btn btn-lost" onclick="location.href='report-lost.html'">Report Lost</button>
				<button class="btn btn-browse" onclick="location.href='list.html'">Browse</button>
				<button class="btn btn-browse" id='login-btn'
					onclick="location.href='login.html'">Login/Register</button>
			</div>
			<div class="profile-container">
				<div class="username-display" id="headerUsername"></div>
				<img src="./Profile.jpg" alt="Profile" class="profile-img" id="profileImg" />
				<div class="profile-dropdown" id="profileDropdown">
					<div class="dropdown-username" id="username" onclick="location.href='profile.html'">
						<a id='profileLink'>Loading...</a>
					</div>
					<div class="dropdown-divider"></div>
					<div class="dropdown-item" id="resetPasswordBtn">Reset Password</div>
					<div class="dropdown-divider"></div>
					<div class="dropdown-item" id="signoutBtn">Sign Out</div>
				</div>
			</div>
		</header>
		<!-- Profile Header -->
		<section class="profile-header">
			<img src="./Profile.jpg" alt="Profile" class="profile-avatar" id="profileAvatar" />
			<h1 class="profile-name" id="profileName">Loading...</h1>
			<p class="profile-email" id="profileEmail">Loading...</p>
			<div class="profile-stats">
				<div class="stat-item">
					<div class="stat-number" id="totalPosts">0</div>
					<div class="stat-label">Total Posts</div>
				</div>
				<div class="stat-item">
					<div class="stat-number" id="activePosts">0</div>
					<div class="stat-label">Active Posts</div>
				</div>
				<div class="stat-item">
					<div class="stat-number" id="foundPosts">0</div>
					<div class="stat-label">Contributions</div>
				</div>
			</div>
		</section>
		<!-- Posts Section -->
		<section class="posts-section">
			<h2 class="section-title">My Posts</h2>
			<div class="posts-filter">
				<button class="filter-btn active" data-filter="all">All Posts</button>
				<button class="filter-btn" data-filter="active">Active</button>
				<button class="filter-btn" data-filter="found">Found</button>
			</div>
			<div id="postsContainer">
				<div class="loading-spinner">
					<span>Loading your posts...</span>
				</div>
			</div>
		</section>
		<!-- Particle Background -->
		<script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
		<script>
			document.addEventListener('DOMContentLoaded', () => {
				tsParticles.load("tsparticles", {
					background: { color: "#0d0d2b" },
					fpsLimit: 60,
					particles: {
						number: { value: 80 },
						color: { value: ["#ffffff", "#FFA726", "#009688"] },
						links: { enable: true, distance: 140, color: "#fff", opacity: 0.25 },
						move: { enable: true, speed: 1 },
						size: { value: { min: 2, max: 4 } },
						opacity: { value: 0.6 }
					},
					interactivity: { events: { onHover: { enable: true, mode: "repulse" } } },
					detectRetina: true
				});
			});
		</script>
		<!-- Firebase Integration -->
		<script type="module">
			import { getCurrentUser, getUserInfo, logoutUser, getUserLostItems } from "./firebase.js";
			import {
				getAuth,
				sendPasswordResetEmail,
			} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

			let currentUser = null;
			let allUserPosts = [];
			let currentFilter = 'all';

			// Format date function
			function formatDate(dateString) {
				const date = new Date(dateString);
				return date.toLocaleDateString('en-US', {
					year: 'numeric',
					month: 'short',
					day: 'numeric'
				});
			}

			// Create post card HTML
			function createPostCard(post) {
				const status = post.status || 'active';
				const statusClass = status === 'found' ? 'status-found' : 'status-active';
				const statusText = status === 'found' ? 'Found' : 'Active';

				return `
                <div class="post-card" data-status="${status}">
                    <div class="post-status ${statusClass}">${statusText}</div>
                    <img src="${post.image}" alt="${post.itemName}" class="post-image"
                         onerror="this.classList.add('error'); this.innerHTML='<span>Image not available</span>';"
                         loading="lazy">
                    <h3 class="post-title">${post.itemName}</h3>
                    <div class="post-details">
                        <div class="post-detail-item">
                            <span class="post-detail-icon">📍</span>
                            <span>${post.location}</span>
                        </div>
                        <div class="post-detail-item">
                            <span class="post-detail-icon">📂</span>
                            <span>${post.category}</span>
                        </div>
                        <div class="post-detail-item">
                            <span class="post-detail-icon">📅</span>
                            <span>Posted ${formatDate(post.createdAt)}</span>
                        </div>
                    </div>
                    <div class="post-actions">
                        <a href="item-details.html?id=${post.id}" class="action-btn btn-primary">View Details</a>
                    <!--    <button class="action-btn btn-secondary" onclick="editPost('${post.id}')">Edit</button>
                        <button class="action-btn btn-secondary" onclick="deletePost('${post.id}')">Delete</button>
					-->
                    </div>
                </div>
            `;
			}

			// Filter posts
			function filterPosts(filter) {
				currentFilter = filter;
				displayPosts();

				// Update filter buttons
				document.querySelectorAll('.filter-btn').forEach(btn => {
					btn.classList.remove('active');
				});
				document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
			}

			// Display posts
			function displayPosts() {
				const container = document.getElementById('postsContainer');
				let filteredPosts = allUserPosts;

				if (currentFilter === 'active') {
					filteredPosts = allUserPosts.filter(post => post.status !== 'found');
				} else if (currentFilter === 'found') {
					filteredPosts = allUserPosts.filter(post => post.status === 'found');
				}

				if (filteredPosts.length === 0) {
					const emptyMessage = currentFilter === 'all' ?
						'No posts yet' :
						currentFilter === 'active' ?
							'No active posts' :
							'No found items';

					container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📭</div>
                        <div class="empty-message">${emptyMessage}</div>
                        <a href="report-lost.html" class="empty-action">Report Lost Item</a>
                    </div>
                `;
				} else {
					container.innerHTML = `
                    <div class="posts-grid">
                        ${filteredPosts.map(createPostCard).join('')}
                    </div>
                `;
				}
			}

			// Load user profile and posts
			async function loadProfile() {
				try {
					currentUser = await getCurrentUser();

					if (!currentUser) {
						window.location.href = 'login.html';
						return;
					}

					// Load user info
					const userInfo = await getUserInfo(currentUser.uid);

					document.getElementById('profileName').textContent = userInfo.data.username;
					document.getElementById('profileEmail').textContent = currentUser.email;

					// Load user's posts
					const result = await getUserLostItems(currentUser.uid);

					if (result.success) {
						allUserPosts = result.data;
						updateStats();
						displayPosts();
					} else {
						console.error('Failed to load posts:', result.error);
						document.getElementById('postsContainer').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">⚠️</div>
                            <div class="empty-message">Failed to load posts</div>
                            <button class="empty-action" onclick="location.reload()">Try Again</button>
                        </div>
                    `;
					}
				} catch (error) {
					console.error('Error loading profile:', error);
					window.location.href = 'login.html';
				}
			}

			// Update statistics
			function updateStats() {
				const totalPosts = allUserPosts.length;
				const activePosts = allUserPosts.filter(post => post.status !== 'found').length;
				const foundPosts = allUserPosts.filter(post => post.status === 'found').length;

				// Animate numbers
				setTimeout(() => animateNumber(document.getElementById('totalPosts'), totalPosts), 300);
				setTimeout(() => animateNumber(document.getElementById('activePosts'), activePosts), 600);
				setTimeout(() => animateNumber(document.getElementById('foundPosts'), foundPosts), 900);
			}

			// Animate number function
			function animateNumber(element, target, duration = 1000) {
				const start = 0;
				const startTime = Date.now();

				function updateNumber() {
					const elapsed = Date.now() - startTime;
					const progress = Math.min(elapsed / duration, 1);
					const easeOut = 1 - Math.pow(1 - progress, 3);
					const current = Math.floor(start + (target - start) * easeOut);

					element.textContent = current;

					if (progress < 1) {
						requestAnimationFrame(updateNumber);
					}
				}

				updateNumber();
			}

			// Global functions
			window.editPost = function (postId) {
				// Navigate to edit page
				window.location.href = `report-lost.html?edit=${postId}`;
			};

			window.deletePost = function (postId) {
				if (confirm('Are you sure you want to delete this post? This action cannot be undone.')) {
					// Implementation for deleting post would go here
					console.log('Delete post:', postId);
					// You would call a Firebase function to delete the post
				}
			};

			// Event listeners
			document.querySelectorAll('.filter-btn').forEach(btn => {
				btn.addEventListener('click', (e) => {
					filterPosts(e.target.dataset.filter);
				});
			});

			// Load profile on page load
			loadProfile();
		</script>
	</body>

</html>